10:41AM INFO <config/app_config.go:97> Server 🗄️ : Environment variables loaded from .env file
10:41AM INFO <config/app_config.go:103> Server 🗄️ : App config loaded db="postgres://postgres:password@localhost:5432/fintech?sslmode=disable" jwt_expiry=72h0m0s exchange_cache_ttl=72h0m0s exchange_api_url=https://v6.exchangerate-api.com/v6 exchange_api_key=9d****4c10 rate_limit_max_requests=100 rate_limit_window=1m0s
10:41AM INFO <server/main.go:56> Server 🗄️ : Configuration loaded successfully database_url_configured=true jwt_expiry=72h0m0s exchange_rate_api_configured=true
10:41AM INFO <server/main.go:68> Server 🗄️ : Currency registry initialized successfully
10:41AM INFO <infra/factory.go:26> Server 🗄️ : Using Redis for exchange rate cache url=redis://localhost:6379/1
10:41AM INFO <infra/factory.go:44> Server 🗄️ : ExchangeRate API provider configured apiKey=9df6...4c10
10:41AM INFO <provider/exchangerate_api.go:65> Server 🗄️ : Exchange rates cache is still valid, skipping fetch base=USD lastUpdate="2025-07-19 19:23:17.529286 +0300 EEST"
10:41AM INFO <infra/factory.go:70> Server 🗄️ : Exchange rate system initialized providers=1 fallbackEnabled=false cacheTTL=72h0m0s
10:41AM INFO <server/main.go:87> Server 🗄️ : Starting fintech server port=:3000
Registering handler for event type: ConversionRequestedEvent

 ┌───────────────────────────────────────────────────┐
 │                   Fiber v2.52.8                   │
 │               http://127.0.0.1:3000               │
 │                                                   │
 │ Handlers ............ 58  Processes ........... 1 │
 │ Prefork ....... Disabled  PID ............. 58674 │
 └───────────────────────────────────────────────────┘

10:41AM INFO <auth/auth.go:64> Server 🗄️ : GetCurrentUserId called
10:41AM INFO <deposit/vallidation.go:21> Server 🗄️ : [DEPTH] Event received handler=DepositValidationHandler event_type=DepositRequestedEvent type=DepositRequestedEvent depth=1 event="{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 48d8c276-92d3-4339-adf1-5337916b95bd 1000 JPY  2025-07-20 13:41:45.326266 +0300 EEST m=+4.996243168}"
10:41AM INFO <deposit/vallidation.go:28> Server 🗄️ : [CHECK] DepositRequestedEvent amount currency handler=DepositValidationHandler event_type=DepositRequestedEvent currency=JPY
10:41AM INFO <deposit/vallidation.go:33> Server 🗄️ : 🟢 [START] Received event handler=DepositValidationHandler event_type=DepositRequestedEvent correlation_id=7bec4780-0e91-4453-bf34-775f46d5b6ab event="{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 48d8c276-92d3-4339-adf1-5337916b95bd 1000 JPY  2025-07-20 13:41:45.326266 +0300 EEST m=+4.996243168}"

2025/07/20 13:41:45 [32m/Users/amir/projects/fintech/infra/repository/account/repository.go:38
[0m[33m[6.043ms] [34;1m[rows:1][0m SELECT * FROM "accounts" WHERE id = '262b652d-bf2e-4aba-87b0-bb20af7206be' AND "accounts"."deleted_at" IS NULL ORDER BY "accounts"."id" LIMIT 1
10:41AM INFO <deposit/vallidation.go:54> Server 🗄️ : ✅ [SUCCESS] Account validated, emitting DepositValidatedEvent handler=DepositValidationHandler event_type=DepositRequestedEvent correlation_id=7bec4780-0e91-4453-bf34-775f46d5b6ab account_id=262b652d-bf2e-4aba-87b0-bb20af7206be user_id=a26936ee-debc-4fd7-bfaa-a93930d56b5d correlation_id=7bec4780-0e91-4453-bf34-775f46d5b6ab
10:41AM INFO <deposit/persistence.go:24> Server 🗄️ : [DEPTH] Event received handler=DepositPersistenceHandler event_type=DepositValidatedEvent type=DepositValidatedEvent depth=2 event="{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 48d8c276-92d3-4339-adf1-5337916b95bd 1000 JPY  2025-07-20 13:41:45.326266 +0300 EEST m=+4.996243168} 0x140001e6ea0}"
10:41AM INFO <deposit/persistence.go:25> Server 🗄️ : 🟢 [START] Received event handler=DepositPersistenceHandler event_type=DepositValidatedEvent event="{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 48d8c276-92d3-4339-adf1-5337916b95bd 1000 JPY  2025-07-20 13:41:45.326266 +0300 EEST m=+4.996243168} 0x140001e6ea0}"
10:41AM INFO <deposit/persistence.go:38> Server 🗄️ : 🔄 [PROCESS] Received DepositValidatedEvent handler=DepositPersistenceHandler event_type=DepositValidatedEvent correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c event="{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 48d8c276-92d3-4339-adf1-5337916b95bd 1000 JPY  2025-07-20 13:41:45.326266 +0300 EEST m=+4.996243168} 0x140001e6ea0}"
10:41AM INFO <deposit/persistence.go:41> Server 🗄️ : [CHECK] DepositValidatedEvent amount currency before persist handler=DepositPersistenceHandler event_type=DepositValidatedEvent correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c currency=JPY

2025/07/20 13:41:45 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:27
[0m[33m[4.108ms] [34;1m[rows:1][0m INSERT INTO "transactions" ("id","created_at","updated_at","deleted_at","account_id","user_id","amount","currency","balance","status","payment_id","original_amount","original_currency","conversion_rate","money_source","external_target_masked","target_currency") VALUES ('e83cd823-e369-4467-a0be-6f336ba02041','2025-07-20 13:41:45.335','2025-07-20 13:41:45.335',NULL,'262b652d-bf2e-4aba-87b0-bb20af7206be','a26936ee-debc-4fd7-bfaa-a93930d56b5d',1000,'USD',0,'created','',NULL,NULL,NULL,'Internal','','') RETURNING "id"
10:41AM INFO <deposit/persistence.go:68> Server 🗄️ : ✅ [SUCCESS] Transaction persisted handler=DepositPersistenceHandler event_type=DepositValidatedEvent correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/persistence.go:81> Server 🗄️ : 📤 [EMIT] Emitting DepositPersistedEvent handler=DepositPersistenceHandler event_type=DepositValidatedEvent correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 48d8c276-92d3-4339-adf1-5337916b95bd 1000 JPY  2025-07-20 13:41:45.326266 +0300 EEST m=+4.996243168} 0x140001e6ea0} e83cd823-e369-4467-a0be-6f336ba02041 1000 JPY}" correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/persistence.go:87> Server 🗄️ : 📤 [EMIT] Emitting ConversionRequestedEvent for deposit handler=DepositPersistenceHandler event_type=DepositValidatedEvent correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/persistence.go:88> Server 🗄️ : DEBUG: ve.UserID and ve.AccountID handler=DepositPersistenceHandler event_type=DepositValidatedEvent correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c user_id=a26936ee-debc-4fd7-bfaa-a93930d56b5d account_id=262b652d-bf2e-4aba-87b0-bb20af7206be
10:41AM INFO <deposit/persistence.go:98> Server 🗄️ : DEBUG: Full ConversionRequestedEvent handler=DepositPersistenceHandler event_type=DepositValidatedEvent correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c event="{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 0  0}"
10:41AM INFO <deposit/persistence.go:99> Server 🗄️ : 📤 [EMIT] About to emit ConversionRequestedEvent handler=DepositPersistenceHandler event_type=DepositValidatedEvent correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c handler=DepositPersistenceHandler event_type=ConversionRequestedEvent correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <conversion/handler.go:20> Server 🗄️ : 🟢 [START] Received event handler=ConversionHandler event_type=ConversionRequestedEvent event="{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 0  0}"
10:41AM INFO <conversion/handler.go:54> Server 🗄️ : 🔄 [PROCESS] Conversion completed successfully handler=ConversionHandler event_type=ConversionRequestedEvent from="1000 JPY" to="1000 JPY" rate=1 request_id=e83cd823-e369-4467-a0be-6f336ba02041
10:41AM INFO <conversion/handler.go:60> Server 🗄️ : [DEBUG] Currency conversion result handler=ConversionHandler event_type=ConversionRequestedEvent original_amount=1000 original_currency=JPY converted_amount=1000 converted_currency=JPY rate=1
10:41AM INFO <conversion/handler.go:98> Server 🗄️ : 📤 [EMIT] Emitting DepositConversionDoneEvent handler=ConversionHandler event_type=ConversionRequestedEvent event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}" correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <conversion/handler.go:100> Server 🗄️ : [DEBUG] Conversion event construction handler=ConversionHandler event_type=ConversionRequestedEvent from_currency=JPY to_currency=JPY original_currency=JPY
10:41AM INFO <deposit/conversion_persistence.go:19> Server 🗄️ : received event handler=DepositConversionPersistenceHandler event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <deposit/conversion_persistence.go:36> Server 🗄️ : received DepositConversionDoneEvent handler=DepositConversionPersistenceHandler correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}" correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/conversion_persistence.go:52> Server 🗄️ : updating transaction with conversion data handler=DepositConversionPersistenceHandler correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 original_amount=1000 original_currency=JPY converted_amount=1000 conversion_rate=1 correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/conversion_persistence.go:77> Server 🗄️ : [CHECK] Conversion data before update handler=DepositConversionPersistenceHandler correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c original_amount=1000 converted_amount=1000 original_currency=JPY conversion_rate=1

2025/07/20 13:41:45 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:33
[0m[33m[1.661ms] [34;1m[rows:1][0m UPDATE "transactions" SET "conversion_rate"=1,"original_amount"=1000,"original_currency"='JPY',"updated_at"='2025-07-20 13:41:45.342' WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL
10:41AM INFO <deposit/conversion_persistence.go:89> Server 🗄️ : transaction updated with conversion data handler=DepositConversionPersistenceHandler correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/conversion_persistence.go:98> Server 🗄️ : conversion data persisted successfully handler=DepositConversionPersistenceHandler correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/conversion_persistence.go:19> Server 🗄️ : received event handler=DepositConversionPersistenceHandler event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <deposit/conversion_persistence.go:36> Server 🗄️ : received DepositConversionDoneEvent handler=DepositConversionPersistenceHandler correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}" correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/conversion_persistence.go:52> Server 🗄️ : updating transaction with conversion data handler=DepositConversionPersistenceHandler correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 original_amount=1000 original_currency=JPY converted_amount=1000 conversion_rate=1 correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/conversion_persistence.go:77> Server 🗄️ : [CHECK] Conversion data before update handler=DepositConversionPersistenceHandler correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c original_amount=1000 converted_amount=1000 original_currency=JPY conversion_rate=1

2025/07/20 13:41:45 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:33
[0m[33m[0.727ms] [34;1m[rows:1][0m UPDATE "transactions" SET "conversion_rate"=1,"original_amount"=1000,"original_currency"='JPY',"updated_at"='2025-07-20 13:41:45.345' WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL
10:41AM INFO <deposit/conversion_persistence.go:89> Server 🗄️ : transaction updated with conversion data handler=DepositConversionPersistenceHandler correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/conversion_persistence.go:98> Server 🗄️ : conversion data persisted successfully handler=DepositConversionPersistenceHandler correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/conversion_persistence.go:19> Server 🗄️ : received event handler=DepositConversionPersistenceHandler event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <deposit/conversion_persistence.go:36> Server 🗄️ : received DepositConversionDoneEvent handler=DepositConversionPersistenceHandler correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}" correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/conversion_persistence.go:52> Server 🗄️ : updating transaction with conversion data handler=DepositConversionPersistenceHandler correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 original_amount=1000 original_currency=JPY converted_amount=1000 conversion_rate=1 correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/conversion_persistence.go:77> Server 🗄️ : [CHECK] Conversion data before update handler=DepositConversionPersistenceHandler correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c original_amount=1000 converted_amount=1000 original_currency=JPY conversion_rate=1

2025/07/20 13:41:45 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:33
[0m[33m[0.755ms] [34;1m[rows:1][0m UPDATE "transactions" SET "conversion_rate"=1,"original_amount"=1000,"original_currency"='JPY',"updated_at"='2025-07-20 13:41:45.348' WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL
10:41AM INFO <deposit/conversion_persistence.go:89> Server 🗄️ : transaction updated with conversion data handler=DepositConversionPersistenceHandler correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/conversion_persistence.go:98> Server 🗄️ : conversion data persisted successfully handler=DepositConversionPersistenceHandler correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/conversion_persistence.go:19> Server 🗄️ : received event handler=DepositConversionPersistenceHandler event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <deposit/conversion_persistence.go:36> Server 🗄️ : received DepositConversionDoneEvent handler=DepositConversionPersistenceHandler correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}" correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/conversion_persistence.go:52> Server 🗄️ : updating transaction with conversion data handler=DepositConversionPersistenceHandler correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 original_amount=1000 original_currency=JPY converted_amount=1000 conversion_rate=1 correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/conversion_persistence.go:77> Server 🗄️ : [CHECK] Conversion data before update handler=DepositConversionPersistenceHandler correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c original_amount=1000 converted_amount=1000 original_currency=JPY conversion_rate=1

2025/07/20 13:41:45 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:33
[0m[33m[0.519ms] [34;1m[rows:1][0m UPDATE "transactions" SET "conversion_rate"=1,"original_amount"=1000,"original_currency"='JPY',"updated_at"='2025-07-20 13:41:45.35' WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL
10:41AM INFO <deposit/conversion_persistence.go:89> Server 🗄️ : transaction updated with conversion data handler=DepositConversionPersistenceHandler correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/conversion_persistence.go:98> Server 🗄️ : conversion data persisted successfully handler=DepositConversionPersistenceHandler correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/conversion_persistence.go:19> Server 🗄️ : received event handler=DepositConversionPersistenceHandler event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <deposit/conversion_persistence.go:36> Server 🗄️ : received DepositConversionDoneEvent handler=DepositConversionPersistenceHandler correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}" correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/conversion_persistence.go:52> Server 🗄️ : updating transaction with conversion data handler=DepositConversionPersistenceHandler correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 original_amount=1000 original_currency=JPY converted_amount=1000 conversion_rate=1 correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/conversion_persistence.go:77> Server 🗄️ : [CHECK] Conversion data before update handler=DepositConversionPersistenceHandler correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c original_amount=1000 converted_amount=1000 original_currency=JPY conversion_rate=1

2025/07/20 13:41:45 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:33
[0m[33m[0.468ms] [34;1m[rows:1][0m UPDATE "transactions" SET "conversion_rate"=1,"original_amount"=1000,"original_currency"='JPY',"updated_at"='2025-07-20 13:41:45.352' WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL
10:41AM INFO <deposit/conversion_persistence.go:89> Server 🗄️ : transaction updated with conversion data handler=DepositConversionPersistenceHandler correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/conversion_persistence.go:98> Server 🗄️ : conversion data persisted successfully handler=DepositConversionPersistenceHandler correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/conversion_persistence.go:19> Server 🗄️ : received event handler=DepositConversionPersistenceHandler event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <deposit/conversion_persistence.go:36> Server 🗄️ : received DepositConversionDoneEvent handler=DepositConversionPersistenceHandler correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}" correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/conversion_persistence.go:52> Server 🗄️ : updating transaction with conversion data handler=DepositConversionPersistenceHandler correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 original_amount=1000 original_currency=JPY converted_amount=1000 conversion_rate=1 correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/conversion_persistence.go:77> Server 🗄️ : [CHECK] Conversion data before update handler=DepositConversionPersistenceHandler correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c original_amount=1000 converted_amount=1000 original_currency=JPY conversion_rate=1

2025/07/20 13:41:45 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:33
[0m[33m[0.506ms] [34;1m[rows:1][0m UPDATE "transactions" SET "conversion_rate"=1,"original_amount"=1000,"original_currency"='JPY',"updated_at"='2025-07-20 13:41:45.353' WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL
10:41AM INFO <deposit/conversion_persistence.go:89> Server 🗄️ : transaction updated with conversion data handler=DepositConversionPersistenceHandler correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/conversion_persistence.go:98> Server 🗄️ : conversion data persisted successfully handler=DepositConversionPersistenceHandler correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/conversion_persistence.go:19> Server 🗄️ : received event handler=DepositConversionPersistenceHandler event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <deposit/conversion_persistence.go:36> Server 🗄️ : received DepositConversionDoneEvent handler=DepositConversionPersistenceHandler correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}" correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/conversion_persistence.go:52> Server 🗄️ : updating transaction with conversion data handler=DepositConversionPersistenceHandler correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 original_amount=1000 original_currency=JPY converted_amount=1000 conversion_rate=1 correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/conversion_persistence.go:77> Server 🗄️ : [CHECK] Conversion data before update handler=DepositConversionPersistenceHandler correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c original_amount=1000 converted_amount=1000 original_currency=JPY conversion_rate=1

2025/07/20 13:41:45 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:33
[0m[33m[0.359ms] [34;1m[rows:1][0m UPDATE "transactions" SET "conversion_rate"=1,"original_amount"=1000,"original_currency"='JPY',"updated_at"='2025-07-20 13:41:45.355' WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL
10:41AM INFO <deposit/conversion_persistence.go:89> Server 🗄️ : transaction updated with conversion data handler=DepositConversionPersistenceHandler correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/conversion_persistence.go:98> Server 🗄️ : conversion data persisted successfully handler=DepositConversionPersistenceHandler correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM WARN <eventbus/memory_event_bus.go:77> Server 🗄️ : Event chain too deep, possible loop detected event=DepositConversionDoneEvent depth=10
10:41AM ERRO <deposit/conversion_persistence.go:107> Server 🗄️ : failed to publish DepositConversionDoneEvent handler=DepositConversionPersistenceHandler correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c error="event chain too deep"
10:41AM INFO <deposit/business_validation.go:18> Server 🗄️ : [DEPTH] Event received handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent type=DepositConversionDoneEvent depth=10 event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <deposit/business_validation.go:19> Server 🗄️ : 🟢 [START] Received event handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <deposit/business_validation.go:25> Server 🗄️ : [DEBUG] Incoming DepositConversionDoneEvent IDs handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent user_id=a26936ee-debc-4fd7-bfaa-a93930d56b5d account_id=262b652d-bf2e-4aba-87b0-bb20af7206be
10:41AM INFO <deposit/business_validation.go:36> Server 🗄️ : [CHECK] DepositConversionDoneEvent currencies at business validation handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c from_currency=JPY to_currency=JPY
10:41AM INFO <deposit/business_validation.go:39> Server 🗄️ : ✅ [SUCCESS] Business validation passed after conversion, emitting DepositBusinessValidatedEvent handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c user_id=a26936ee-debc-4fd7-bfaa-a93930d56b5d account_id=262b652d-bf2e-4aba-87b0-bb20af7206be amount=1000 currency=JPY correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/business_validation.go:51> Server 🗄️ : 📤 [EMIT] Emitting DepositBusinessValidatedEvent handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c event="{{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041} e83cd823-e369-4467-a0be-6f336ba02041}" correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM WARN <eventbus/memory_event_bus.go:77> Server 🗄️ : Event chain too deep, possible loop detected event=DepositBusinessValidatedEvent depth=10
10:41AM ERRO <deposit/conversion_persistence.go:107> Server 🗄️ : failed to publish DepositConversionDoneEvent handler=DepositConversionPersistenceHandler correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c error="event chain too deep"
10:41AM INFO <deposit/business_validation.go:18> Server 🗄️ : [DEPTH] Event received handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent type=DepositConversionDoneEvent depth=9 event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <deposit/business_validation.go:19> Server 🗄️ : 🟢 [START] Received event handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <deposit/business_validation.go:25> Server 🗄️ : [DEBUG] Incoming DepositConversionDoneEvent IDs handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent user_id=a26936ee-debc-4fd7-bfaa-a93930d56b5d account_id=262b652d-bf2e-4aba-87b0-bb20af7206be
10:41AM INFO <deposit/business_validation.go:36> Server 🗄️ : [CHECK] DepositConversionDoneEvent currencies at business validation handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c from_currency=JPY to_currency=JPY
10:41AM INFO <deposit/business_validation.go:39> Server 🗄️ : ✅ [SUCCESS] Business validation passed after conversion, emitting DepositBusinessValidatedEvent handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c user_id=a26936ee-debc-4fd7-bfaa-a93930d56b5d account_id=262b652d-bf2e-4aba-87b0-bb20af7206be amount=1000 currency=JPY correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/business_validation.go:51> Server 🗄️ : 📤 [EMIT] Emitting DepositBusinessValidatedEvent handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c event="{{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041} e83cd823-e369-4467-a0be-6f336ba02041}" correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <payment/initiation_handler.go:23> Server 🗄️ : 🟢 [START] Received validation event handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent event="{{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <payment/initiation_handler.go:44> Server 🗄️ : 🔄 [PROCESS] Processing deposit business validation for payment initiation handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent user_id=a26936ee-debc-4fd7-bfaa-a93930d56b5d account_id=262b652d-bf2e-4aba-87b0-bb20af7206be amount=1000 currency=JPY correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <payment/initiation_handler.go:69> Server 🗄️ : ✅ [SUCCESS] Payment initiated successfully handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent payment_id=pi_3RmugfR7vH7wmQ1V2xUlN7ls correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM WARN <eventbus/memory_event_bus.go:77> Server 🗄️ : Event chain too deep, possible loop detected event=PaymentInitiatedEvent depth=10
10:41AM ERRO <payment/initiation_handler.go:87> Server 🗄️ : ❌ [ERROR] Failed to publish PaymentInitiatedEvent handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent error="event chain too deep" correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/conversion_done.go:19> Server 🗄️ : [DEPTH] Event received handler=DepositConversionDoneHandler event_type=DepositConversionDoneEvent type=DepositConversionDoneEvent depth=9 event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <deposit/conversion_done.go:20> Server 🗄️ : 🟢 [START] Received event handler=DepositConversionDoneHandler event_type=DepositConversionDoneEvent event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <deposit/conversion_done.go:29> Server 🗄️ : 🔄 [PROCESS] Mapping DepositConversionDoneEvent to DepositBusinessValidatedEvent handler=DepositConversionDoneHandler event_type=DepositConversionDoneEvent handler=DepositConversionDoneHandler event_type=DepositConversionDoneEvent correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c from_amount="1000 JPY" to_amount="1000 JPY" request_id=e83cd823-e369-4467-a0be-6f336ba02041
10:41AM INFO <deposit/conversion_done.go:36> Server 🗄️ : 📤 [EMIT] Emitting DepositBusinessValidatedEvent handler=DepositConversionDoneHandler event_type=DepositConversionDoneEvent event="{{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041} e83cd823-e369-4467-a0be-6f336ba02041}" correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <payment/initiation_handler.go:23> Server 🗄️ : 🟢 [START] Received validation event handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent event="{{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <payment/initiation_handler.go:44> Server 🗄️ : 🔄 [PROCESS] Processing deposit business validation for payment initiation handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent user_id=a26936ee-debc-4fd7-bfaa-a93930d56b5d account_id=262b652d-bf2e-4aba-87b0-bb20af7206be amount=1000 currency=JPY correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <payment/initiation_handler.go:69> Server 🗄️ : ✅ [SUCCESS] Payment initiated successfully handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent payment_id=pi_3RmuggR7vH7wmQ1V1wuXBUmo correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM WARN <eventbus/memory_event_bus.go:77> Server 🗄️ : Event chain too deep, possible loop detected event=PaymentInitiatedEvent depth=10
10:41AM ERRO <payment/initiation_handler.go:87> Server 🗄️ : ❌ [ERROR] Failed to publish PaymentInitiatedEvent handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent error="event chain too deep" correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/business_validation.go:18> Server 🗄️ : [DEPTH] Event received handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent type=DepositConversionDoneEvent depth=8 event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <deposit/business_validation.go:19> Server 🗄️ : 🟢 [START] Received event handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <deposit/business_validation.go:25> Server 🗄️ : [DEBUG] Incoming DepositConversionDoneEvent IDs handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent user_id=a26936ee-debc-4fd7-bfaa-a93930d56b5d account_id=262b652d-bf2e-4aba-87b0-bb20af7206be
10:41AM INFO <deposit/business_validation.go:36> Server 🗄️ : [CHECK] DepositConversionDoneEvent currencies at business validation handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c from_currency=JPY to_currency=JPY
10:41AM INFO <deposit/business_validation.go:39> Server 🗄️ : ✅ [SUCCESS] Business validation passed after conversion, emitting DepositBusinessValidatedEvent handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c user_id=a26936ee-debc-4fd7-bfaa-a93930d56b5d account_id=262b652d-bf2e-4aba-87b0-bb20af7206be amount=1000 currency=JPY correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/business_validation.go:51> Server 🗄️ : 📤 [EMIT] Emitting DepositBusinessValidatedEvent handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c event="{{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041} e83cd823-e369-4467-a0be-6f336ba02041}" correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <payment/initiation_handler.go:23> Server 🗄️ : 🟢 [START] Received validation event handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent event="{{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <payment/initiation_handler.go:44> Server 🗄️ : 🔄 [PROCESS] Processing deposit business validation for payment initiation handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent user_id=a26936ee-debc-4fd7-bfaa-a93930d56b5d account_id=262b652d-bf2e-4aba-87b0-bb20af7206be amount=1000 currency=JPY correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <payment/initiation_handler.go:69> Server 🗄️ : ✅ [SUCCESS] Payment initiated successfully handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent payment_id=pi_3RmuggR7vH7wmQ1V2FRhw7sD correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <payment/persistence_handler.go:26> Server 🗄️ : received payment initiated event handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent event="{c3c39b2f-5e8e-48c3-aee5-696772b8ab62 e83cd823-e369-4467-a0be-6f336ba02041 pi_3RmuggR7vH7wmQ1V2FRhw7sD initiated a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c}"
10:41AM INFO <payment/persistence_handler.go:34> Server 🗄️ : updating transaction with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmuggR7vH7wmQ1V2FRhw7sD

2025/07/20 13:41:46 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:57
[0m[33m[1.890ms] [34;1m[rows:1][0m SELECT * FROM "transactions" WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL ORDER BY "transactions"."id" LIMIT 1

2025/07/20 13:41:46 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:33
[0m[33m[1.420ms] [34;1m[rows:1][0m UPDATE "transactions" SET "payment_id"='pi_3RmuggR7vH7wmQ1V2FRhw7sD',"status"='pending',"updated_at"='2025-07-20 13:41:46.728' WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL
10:41AM INFO <payment/persistence_handler.go:70> Server 🗄️ : transaction updated with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmuggR7vH7wmQ1V2FRhw7sD
10:41AM INFO <payment/persistence_handler.go:26> Server 🗄️ : received payment initiated event handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent event="{c3c39b2f-5e8e-48c3-aee5-696772b8ab62 e83cd823-e369-4467-a0be-6f336ba02041 pi_3RmuggR7vH7wmQ1V2FRhw7sD initiated a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c}"
10:41AM INFO <payment/persistence_handler.go:34> Server 🗄️ : updating transaction with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmuggR7vH7wmQ1V2FRhw7sD

2025/07/20 13:41:46 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:57
[0m[33m[0.950ms] [34;1m[rows:1][0m SELECT * FROM "transactions" WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL ORDER BY "transactions"."id" LIMIT 1
10:41AM WARN <payment/persistence_handler.go:58> Server 🗄️ : Duplicate PaymentIdPersistedEvent emission detected: transaction already has payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 existing_payment_id=pi_3RmuggR7vH7wmQ1V2FRhw7sD

2025/07/20 13:41:46 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:33
[0m[33m[0.663ms] [34;1m[rows:1][0m UPDATE "transactions" SET "payment_id"='pi_3RmuggR7vH7wmQ1V2FRhw7sD',"status"='pending',"updated_at"='2025-07-20 13:41:46.733' WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL
10:41AM INFO <payment/persistence_handler.go:70> Server 🗄️ : transaction updated with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmuggR7vH7wmQ1V2FRhw7sD
10:41AM INFO <payment/initiation_handler.go:91> Server 🗄️ : 📤 [EMIT] PaymentInitiatedEvent published handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent event="{c3c39b2f-5e8e-48c3-aee5-696772b8ab62 e83cd823-e369-4467-a0be-6f336ba02041 pi_3RmuggR7vH7wmQ1V2FRhw7sD initiated a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c}" correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/conversion_done.go:19> Server 🗄️ : [DEPTH] Event received handler=DepositConversionDoneHandler event_type=DepositConversionDoneEvent type=DepositConversionDoneEvent depth=8 event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <deposit/conversion_done.go:20> Server 🗄️ : 🟢 [START] Received event handler=DepositConversionDoneHandler event_type=DepositConversionDoneEvent event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <deposit/conversion_done.go:29> Server 🗄️ : 🔄 [PROCESS] Mapping DepositConversionDoneEvent to DepositBusinessValidatedEvent handler=DepositConversionDoneHandler event_type=DepositConversionDoneEvent handler=DepositConversionDoneHandler event_type=DepositConversionDoneEvent correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c from_amount="1000 JPY" to_amount="1000 JPY" request_id=e83cd823-e369-4467-a0be-6f336ba02041
10:41AM INFO <deposit/conversion_done.go:36> Server 🗄️ : 📤 [EMIT] Emitting DepositBusinessValidatedEvent handler=DepositConversionDoneHandler event_type=DepositConversionDoneEvent event="{{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041} e83cd823-e369-4467-a0be-6f336ba02041}" correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <payment/initiation_handler.go:23> Server 🗄️ : 🟢 [START] Received validation event handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent event="{{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <payment/initiation_handler.go:44> Server 🗄️ : 🔄 [PROCESS] Processing deposit business validation for payment initiation handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent user_id=a26936ee-debc-4fd7-bfaa-a93930d56b5d account_id=262b652d-bf2e-4aba-87b0-bb20af7206be amount=1000 currency=JPY correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <payment/initiation_handler.go:69> Server 🗄️ : ✅ [SUCCESS] Payment initiated successfully handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent payment_id=pi_3RmuggR7vH7wmQ1V1zKgfcwh correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <payment/persistence_handler.go:26> Server 🗄️ : received payment initiated event handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent event="{8c9ccd8c-59cb-4556-9687-0ab759576e34 e83cd823-e369-4467-a0be-6f336ba02041 pi_3RmuggR7vH7wmQ1V1zKgfcwh initiated a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c}"
10:41AM INFO <payment/persistence_handler.go:34> Server 🗄️ : updating transaction with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmuggR7vH7wmQ1V1zKgfcwh

2025/07/20 13:41:47 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:57
[0m[33m[1.972ms] [34;1m[rows:1][0m SELECT * FROM "transactions" WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL ORDER BY "transactions"."id" LIMIT 1
10:41AM WARN <payment/persistence_handler.go:58> Server 🗄️ : Duplicate PaymentIdPersistedEvent emission detected: transaction already has payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 existing_payment_id=pi_3RmuggR7vH7wmQ1V2FRhw7sD

2025/07/20 13:41:47 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:33
[0m[33m[1.605ms] [34;1m[rows:1][0m UPDATE "transactions" SET "payment_id"='pi_3RmuggR7vH7wmQ1V1zKgfcwh',"status"='pending',"updated_at"='2025-07-20 13:41:47.071' WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL
10:41AM INFO <payment/persistence_handler.go:70> Server 🗄️ : transaction updated with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmuggR7vH7wmQ1V1zKgfcwh
10:41AM INFO <payment/persistence_handler.go:26> Server 🗄️ : received payment initiated event handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent event="{8c9ccd8c-59cb-4556-9687-0ab759576e34 e83cd823-e369-4467-a0be-6f336ba02041 pi_3RmuggR7vH7wmQ1V1zKgfcwh initiated a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c}"
10:41AM INFO <payment/persistence_handler.go:34> Server 🗄️ : updating transaction with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmuggR7vH7wmQ1V1zKgfcwh

2025/07/20 13:41:47 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:57
[0m[33m[1.454ms] [34;1m[rows:1][0m SELECT * FROM "transactions" WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL ORDER BY "transactions"."id" LIMIT 1
10:41AM WARN <payment/persistence_handler.go:58> Server 🗄️ : Duplicate PaymentIdPersistedEvent emission detected: transaction already has payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 existing_payment_id=pi_3RmuggR7vH7wmQ1V1zKgfcwh

2025/07/20 13:41:47 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:33
[0m[33m[1.907ms] [34;1m[rows:1][0m UPDATE "transactions" SET "payment_id"='pi_3RmuggR7vH7wmQ1V1zKgfcwh',"status"='pending',"updated_at"='2025-07-20 13:41:47.079' WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL
10:41AM INFO <payment/persistence_handler.go:70> Server 🗄️ : transaction updated with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmuggR7vH7wmQ1V1zKgfcwh
10:41AM INFO <payment/initiation_handler.go:91> Server 🗄️ : 📤 [EMIT] PaymentInitiatedEvent published handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent event="{8c9ccd8c-59cb-4556-9687-0ab759576e34 e83cd823-e369-4467-a0be-6f336ba02041 pi_3RmuggR7vH7wmQ1V1zKgfcwh initiated a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c}" correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/business_validation.go:18> Server 🗄️ : [DEPTH] Event received handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent type=DepositConversionDoneEvent depth=7 event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <deposit/business_validation.go:19> Server 🗄️ : 🟢 [START] Received event handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <deposit/business_validation.go:25> Server 🗄️ : [DEBUG] Incoming DepositConversionDoneEvent IDs handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent user_id=a26936ee-debc-4fd7-bfaa-a93930d56b5d account_id=262b652d-bf2e-4aba-87b0-bb20af7206be
10:41AM INFO <deposit/business_validation.go:36> Server 🗄️ : [CHECK] DepositConversionDoneEvent currencies at business validation handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c from_currency=JPY to_currency=JPY
10:41AM INFO <deposit/business_validation.go:39> Server 🗄️ : ✅ [SUCCESS] Business validation passed after conversion, emitting DepositBusinessValidatedEvent handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c user_id=a26936ee-debc-4fd7-bfaa-a93930d56b5d account_id=262b652d-bf2e-4aba-87b0-bb20af7206be amount=1000 currency=JPY correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/business_validation.go:51> Server 🗄️ : 📤 [EMIT] Emitting DepositBusinessValidatedEvent handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c event="{{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041} e83cd823-e369-4467-a0be-6f336ba02041}" correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <payment/initiation_handler.go:23> Server 🗄️ : 🟢 [START] Received validation event handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent event="{{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <payment/initiation_handler.go:44> Server 🗄️ : 🔄 [PROCESS] Processing deposit business validation for payment initiation handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent user_id=a26936ee-debc-4fd7-bfaa-a93930d56b5d account_id=262b652d-bf2e-4aba-87b0-bb20af7206be amount=1000 currency=JPY correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <payment/initiation_handler.go:69> Server 🗄️ : ✅ [SUCCESS] Payment initiated successfully handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent payment_id=pi_3RmughR7vH7wmQ1V0K18lWaU correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <payment/persistence_handler.go:26> Server 🗄️ : received payment initiated event handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent event="{d9887af0-03c3-4523-a318-3e77c9eff2df e83cd823-e369-4467-a0be-6f336ba02041 pi_3RmughR7vH7wmQ1V0K18lWaU initiated a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c}"
10:41AM INFO <payment/persistence_handler.go:34> Server 🗄️ : updating transaction with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmughR7vH7wmQ1V0K18lWaU

2025/07/20 13:41:47 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:57
[0m[33m[1.588ms] [34;1m[rows:1][0m SELECT * FROM "transactions" WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL ORDER BY "transactions"."id" LIMIT 1
10:41AM WARN <payment/persistence_handler.go:58> Server 🗄️ : Duplicate PaymentIdPersistedEvent emission detected: transaction already has payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 existing_payment_id=pi_3RmuggR7vH7wmQ1V1zKgfcwh

2025/07/20 13:41:47 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:33
[0m[33m[1.170ms] [34;1m[rows:1][0m UPDATE "transactions" SET "payment_id"='pi_3RmughR7vH7wmQ1V0K18lWaU',"status"='pending',"updated_at"='2025-07-20 13:41:47.456' WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL
10:41AM INFO <payment/persistence_handler.go:70> Server 🗄️ : transaction updated with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmughR7vH7wmQ1V0K18lWaU
10:41AM INFO <payment/persistence_handler.go:26> Server 🗄️ : received payment initiated event handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent event="{d9887af0-03c3-4523-a318-3e77c9eff2df e83cd823-e369-4467-a0be-6f336ba02041 pi_3RmughR7vH7wmQ1V0K18lWaU initiated a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c}"
10:41AM INFO <payment/persistence_handler.go:34> Server 🗄️ : updating transaction with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmughR7vH7wmQ1V0K18lWaU

2025/07/20 13:41:47 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:57
[0m[33m[0.942ms] [34;1m[rows:1][0m SELECT * FROM "transactions" WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL ORDER BY "transactions"."id" LIMIT 1
10:41AM WARN <payment/persistence_handler.go:58> Server 🗄️ : Duplicate PaymentIdPersistedEvent emission detected: transaction already has payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 existing_payment_id=pi_3RmughR7vH7wmQ1V0K18lWaU

2025/07/20 13:41:47 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:33
[0m[33m[0.918ms] [34;1m[rows:1][0m UPDATE "transactions" SET "payment_id"='pi_3RmughR7vH7wmQ1V0K18lWaU',"status"='pending',"updated_at"='2025-07-20 13:41:47.462' WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL
10:41AM INFO <payment/persistence_handler.go:70> Server 🗄️ : transaction updated with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmughR7vH7wmQ1V0K18lWaU
10:41AM INFO <payment/initiation_handler.go:91> Server 🗄️ : 📤 [EMIT] PaymentInitiatedEvent published handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent event="{d9887af0-03c3-4523-a318-3e77c9eff2df e83cd823-e369-4467-a0be-6f336ba02041 pi_3RmughR7vH7wmQ1V0K18lWaU initiated a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c}" correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/conversion_done.go:19> Server 🗄️ : [DEPTH] Event received handler=DepositConversionDoneHandler event_type=DepositConversionDoneEvent type=DepositConversionDoneEvent depth=7 event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <deposit/conversion_done.go:20> Server 🗄️ : 🟢 [START] Received event handler=DepositConversionDoneHandler event_type=DepositConversionDoneEvent event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <deposit/conversion_done.go:29> Server 🗄️ : 🔄 [PROCESS] Mapping DepositConversionDoneEvent to DepositBusinessValidatedEvent handler=DepositConversionDoneHandler event_type=DepositConversionDoneEvent handler=DepositConversionDoneHandler event_type=DepositConversionDoneEvent correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c from_amount="1000 JPY" to_amount="1000 JPY" request_id=e83cd823-e369-4467-a0be-6f336ba02041
10:41AM INFO <deposit/conversion_done.go:36> Server 🗄️ : 📤 [EMIT] Emitting DepositBusinessValidatedEvent handler=DepositConversionDoneHandler event_type=DepositConversionDoneEvent event="{{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041} e83cd823-e369-4467-a0be-6f336ba02041}" correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <payment/initiation_handler.go:23> Server 🗄️ : 🟢 [START] Received validation event handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent event="{{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <payment/initiation_handler.go:44> Server 🗄️ : 🔄 [PROCESS] Processing deposit business validation for payment initiation handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent user_id=a26936ee-debc-4fd7-bfaa-a93930d56b5d account_id=262b652d-bf2e-4aba-87b0-bb20af7206be amount=1000 currency=JPY correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <payment/initiation_handler.go:69> Server 🗄️ : ✅ [SUCCESS] Payment initiated successfully handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent payment_id=pi_3RmughR7vH7wmQ1V2PPLKKmu correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <payment/persistence_handler.go:26> Server 🗄️ : received payment initiated event handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent event="{56a48a5c-6d93-40a2-beab-d90609fe06a3 e83cd823-e369-4467-a0be-6f336ba02041 pi_3RmughR7vH7wmQ1V2PPLKKmu initiated a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c}"
10:41AM INFO <payment/persistence_handler.go:34> Server 🗄️ : updating transaction with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmughR7vH7wmQ1V2PPLKKmu

2025/07/20 13:41:47 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:57
[0m[33m[0.920ms] [34;1m[rows:1][0m SELECT * FROM "transactions" WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL ORDER BY "transactions"."id" LIMIT 1
10:41AM WARN <payment/persistence_handler.go:58> Server 🗄️ : Duplicate PaymentIdPersistedEvent emission detected: transaction already has payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 existing_payment_id=pi_3RmughR7vH7wmQ1V0K18lWaU

2025/07/20 13:41:47 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:33
[0m[33m[1.351ms] [34;1m[rows:1][0m UPDATE "transactions" SET "payment_id"='pi_3RmughR7vH7wmQ1V2PPLKKmu',"status"='pending',"updated_at"='2025-07-20 13:41:47.812' WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL
10:41AM INFO <payment/persistence_handler.go:70> Server 🗄️ : transaction updated with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmughR7vH7wmQ1V2PPLKKmu
10:41AM INFO <payment/persistence_handler.go:26> Server 🗄️ : received payment initiated event handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent event="{56a48a5c-6d93-40a2-beab-d90609fe06a3 e83cd823-e369-4467-a0be-6f336ba02041 pi_3RmughR7vH7wmQ1V2PPLKKmu initiated a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c}"
10:41AM INFO <payment/persistence_handler.go:34> Server 🗄️ : updating transaction with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmughR7vH7wmQ1V2PPLKKmu

2025/07/20 13:41:47 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:57
[0m[33m[0.584ms] [34;1m[rows:1][0m SELECT * FROM "transactions" WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL ORDER BY "transactions"."id" LIMIT 1
10:41AM WARN <payment/persistence_handler.go:58> Server 🗄️ : Duplicate PaymentIdPersistedEvent emission detected: transaction already has payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 existing_payment_id=pi_3RmughR7vH7wmQ1V2PPLKKmu

2025/07/20 13:41:47 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:33
[0m[33m[0.468ms] [34;1m[rows:1][0m UPDATE "transactions" SET "payment_id"='pi_3RmughR7vH7wmQ1V2PPLKKmu',"status"='pending',"updated_at"='2025-07-20 13:41:47.816' WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL
10:41AM INFO <payment/persistence_handler.go:70> Server 🗄️ : transaction updated with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmughR7vH7wmQ1V2PPLKKmu
10:41AM INFO <payment/initiation_handler.go:91> Server 🗄️ : 📤 [EMIT] PaymentInitiatedEvent published handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent event="{56a48a5c-6d93-40a2-beab-d90609fe06a3 e83cd823-e369-4467-a0be-6f336ba02041 pi_3RmughR7vH7wmQ1V2PPLKKmu initiated a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c}" correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/business_validation.go:18> Server 🗄️ : [DEPTH] Event received handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent type=DepositConversionDoneEvent depth=6 event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <deposit/business_validation.go:19> Server 🗄️ : 🟢 [START] Received event handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <deposit/business_validation.go:25> Server 🗄️ : [DEBUG] Incoming DepositConversionDoneEvent IDs handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent user_id=a26936ee-debc-4fd7-bfaa-a93930d56b5d account_id=262b652d-bf2e-4aba-87b0-bb20af7206be
10:41AM INFO <deposit/business_validation.go:36> Server 🗄️ : [CHECK] DepositConversionDoneEvent currencies at business validation handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c from_currency=JPY to_currency=JPY
10:41AM INFO <deposit/business_validation.go:39> Server 🗄️ : ✅ [SUCCESS] Business validation passed after conversion, emitting DepositBusinessValidatedEvent handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c user_id=a26936ee-debc-4fd7-bfaa-a93930d56b5d account_id=262b652d-bf2e-4aba-87b0-bb20af7206be amount=1000 currency=JPY correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/business_validation.go:51> Server 🗄️ : 📤 [EMIT] Emitting DepositBusinessValidatedEvent handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c event="{{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041} e83cd823-e369-4467-a0be-6f336ba02041}" correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <payment/initiation_handler.go:23> Server 🗄️ : 🟢 [START] Received validation event handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent event="{{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <payment/initiation_handler.go:44> Server 🗄️ : 🔄 [PROCESS] Processing deposit business validation for payment initiation handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent user_id=a26936ee-debc-4fd7-bfaa-a93930d56b5d account_id=262b652d-bf2e-4aba-87b0-bb20af7206be amount=1000 currency=JPY correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <payment/initiation_handler.go:69> Server 🗄️ : ✅ [SUCCESS] Payment initiated successfully handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent payment_id=pi_3RmugiR7vH7wmQ1V2sEyxLcA correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <payment/persistence_handler.go:26> Server 🗄️ : received payment initiated event handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent event="{6264e152-3cbd-47b7-ba22-3a5c3b6e3509 e83cd823-e369-4467-a0be-6f336ba02041 pi_3RmugiR7vH7wmQ1V2sEyxLcA initiated a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c}"
10:41AM INFO <payment/persistence_handler.go:34> Server 🗄️ : updating transaction with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmugiR7vH7wmQ1V2sEyxLcA

2025/07/20 13:41:48 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:57
[0m[33m[1.241ms] [34;1m[rows:1][0m SELECT * FROM "transactions" WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL ORDER BY "transactions"."id" LIMIT 1
10:41AM WARN <payment/persistence_handler.go:58> eck lerver 🗄️ : Duplicate PaymentIdPersistedEvent emission detected: transaction already has payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 existing_payment_id=pi_3RmughR7vH7wmQ1V2PPLKKmu

2025/07/20 13:41:48 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:33
[0m[33m[1.008ms] [34;1m[rows:1][0m UPDATE "transactions" SET "payment_id"='pi_3RmugiR7vH7wmQ1V2sEyxLcA',"status"='pending',"updated_at"='2025-07-20 13:41:48.156' WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL
10:41AM INFO <payment/persistence_handler.go:70> Server 🗄️ : transaction updated with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmugiR7vH7wmQ1V2sEyxLcA
10:41AM INFO <payment/persistence_handler.go:26> Server 🗄️ : received payment initiated event handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent event="{6264e152-3cbd-47b7-ba22-3a5c3b6e3509 e83cd823-e369-4467-a0be-6f336ba02041 pi_3RmugiR7vH7wmQ1V2sEyxLcA initiated a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c}"
10:41AM INFO <payment/persistence_handler.go:34> Server 🗄️ : updating transaction with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmugiR7vH7wmQ1V2sEyxLcA

2025/07/20 13:41:48 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:57
[0m[33m[0.553ms] [34;1m[rows:1][0m SELECT * FROM "transactions" WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL ORDER BY "transactions"."id" LIMIT 1
10:41AM WARN <payment/persistence_handler.go:58> Server 🗄️ : Duplicate PaymentIdPersistedEvent emission detected: transaction already has payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 existing_payment_id=pi_3RmugiR7vH7wmQ1V2sEyxLcA

2025/07/20 13:41:48 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:33
[0m[33m[0.516ms] [34;1m[rows:1][0m UPDATE "transactions" SET "payment_id"='pi_3RmugiR7vH7wmQ1V2sEyxLcA',"status"='pending',"updated_at"='2025-07-20 13:41:48.16' WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL
10:41AM INFO <payment/persistence_handler.go:70> Server 🗄️ : transaction updated with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmugiR7vH7wmQ1V2sEyxLcA
10:41AM INFO <payment/initiation_handler.go:91> Server 🗄️ : 📤 [EMIT] PaymentInitiatedEvent published handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent event="{6264e152-3cbd-47b7-ba22-3a5c3b6e3509 e83cd823-e369-4467-a0be-6f336ba02041 pi_3RmugiR7vH7wmQ1V2sEyxLcA initiated a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c}" correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/conversion_done.go:19> Server 🗄️ : [DEPTH] Event received handler=DepositConversionDoneHandler event_type=DepositConversionDoneEvent type=DepositConversionDoneEvent depth=6 event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <deposit/conversion_done.go:20> Server 🗄️ : 🟢 [START] Received event handler=DepositConversionDoneHandler event_type=DepositConversionDoneEvent event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <deposit/conversion_done.go:29> Server 🗄️ : 🔄 [PROCESS] Mapping DepositConversionDoneEvent to DepositBusinessValidatedEvent handler=DepositConversionDoneHandler event_type=DepositConversionDoneEvent handler=DepositConversionDoneHandler event_type=DepositConversionDoneEvent correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c from_amount="1000 JPY" to_amount="1000 JPY" request_id=e83cd823-e369-4467-a0be-6f336ba02041
10:41AM INFO <deposit/conversion_done.go:36> Server 🗄️ : 📤 [EMIT] Emitting DepositBusinessValidatedEvent handler=DepositConversionDoneHandler event_type=DepositConversionDoneEvent event="{{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041} e83cd823-e369-4467-a0be-6f336ba02041}" correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <payment/initiation_handler.go:23> Server 🗄️ : 🟢 [START] Received validation event handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent event="{{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <payment/initiation_handler.go:44> Server 🗄️ : 🔄 [PROCESS] Processing deposit business validation for payment initiation handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent user_id=a26936ee-debc-4fd7-bfaa-a93930d56b5d account_id=262b652d-bf2e-4aba-87b0-bb20af7206be amount=1000 currency=JPY correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <payment/initiation_handler.go:69> Server 🗄️ : ✅ [SUCCESS] Payment initiated successfully handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent payment_id=pi_3RmugiR7vH7wmQ1V0E526UrY correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <payment/persistence_handler.go:26> Server 🗄️ : received payment initiated event handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent event="{2f7fbf26-a1de-4b5b-ba25-573cfb22c897 e83cd823-e369-4467-a0be-6f336ba02041 pi_3RmugiR7vH7wmQ1V0E526UrY initiated a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c}"
10:41AM INFO <payment/persistence_handler.go:34> Server 🗄️ : updating transaction with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmugiR7vH7wmQ1V0E526UrY

2025/07/20 13:41:48 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:57
[0m[33m[0.998ms] [34;1m[rows:1][0m SELECT * FROM "transactions" WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL ORDER BY "transactions"."id" LIMIT 1
10:41AM WARN <payment/persistence_handler.go:58> Server 🗄️ : Duplicate PaymentIdPersistedEvent emission detected: transaction already has payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 existing_payment_id=pi_3RmugiR7vH7wmQ1V2sEyxLcA

2025/07/20 13:41:48 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:33
[0m[33m[0.865ms] [34;1m[rows:1][0m UPDATE "transactions" SET "payment_id"='pi_3RmugiR7vH7wmQ1V0E526UrY',"status"='pending',"updated_at"='2025-07-20 13:41:48.512' WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL
10:41AM INFO <payment/persistence_handler.go:70> Server 🗄️ : transaction updated with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmugiR7vH7wmQ1V0E526UrY
10:41AM INFO <payment/persistence_handler.go:26> Server 🗄️ : received payment initiated event handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent event="{2f7fbf26-a1de-4b5b-ba25-573cfb22c897 e83cd823-e369-4467-a0be-6f336ba02041 pi_3RmugiR7vH7wmQ1V0E526UrY initiated a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c}"
10:41AM INFO <payment/persistence_handler.go:34> Server 🗄️ : updating transaction with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmugiR7vH7wmQ1V0E526UrY

2025/07/20 13:41:48 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:57
[0m[33m[0.513ms] [34;1m[rows:1][0m SELECT * FROM "transactions" WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL ORDER BY "transactions"."id" LIMIT 1
10:41AM WARN <payment/persistence_handler.go:58> Server 🗄️ : Duplicate PaymentIdPersistedEvent emission detected: transaction already has payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 existing_payment_id=pi_3RmugiR7vH7wmQ1V0E526UrY

2025/07/20 13:41:48 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:33
[0m[33m[0.512ms] [34;1m[rows:1][0m UPDATE "transactions" SET "payment_id"='pi_3RmugiR7vH7wmQ1V0E526UrY',"status"='pending',"updated_at"='2025-07-20 13:41:48.516' WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL
10:41AM INFO <payment/persistence_handler.go:70> Server 🗄️ : transaction updated with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmugiR7vH7wmQ1V0E526UrY
10:41AM INFO <payment/initiation_handler.go:91> Server 🗄️ : 📤 [EMIT] PaymentInitiatedEvent published handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent event="{2f7fbf26-a1de-4b5b-ba25-573cfb22c897 e83cd823-e369-4467-a0be-6f336ba02041 pi_3RmugiR7vH7wmQ1V0E526UrY initiated a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c}" correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/business_validation.go:18> Server 🗄️ : [DEPTH] Event received handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent type=DepositConversionDoneEvent depth=5 event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <deposit/business_validation.go:19> Server 🗄️ : 🟢 [START] Received event handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <deposit/business_validation.go:25> Server 🗄️ : [DEBUG] Incoming DepositConversionDoneEvent IDs handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent user_id=a26936ee-debc-4fd7-bfaa-a93930d56b5d account_id=262b652d-bf2e-4aba-87b0-bb20af7206be
10:41AM INFO <deposit/business_validation.go:36> Server 🗄️ : [CHECK] DepositConversionDoneEvent currencies at business validation handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c from_currency=JPY to_currency=JPY
10:41AM INFO <deposit/business_validation.go:39> Server 🗄️ : ✅ [SUCCESS] Business validation passed after conversion, emitting DepositBusinessValidatedEvent handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c user_id=a26936ee-debc-4fd7-bfaa-a93930d56b5d account_id=262b652d-bf2e-4aba-87b0-bb20af7206be amount=1000 currency=JPY correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/business_validation.go:51> Server 🗄️ : 📤 [EMIT] Emitting DepositBusinessValidatedEvent handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c event="{{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041} e83cd823-e369-4467-a0be-6f336ba02041}" correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <payment/initiation_handler.go:23> Server 🗄️ : 🟢 [START] Received validation event handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent event="{{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <payment/initiation_handler.go:44> Server 🗄️ : 🔄 [PROCESS] Processing deposit business validation for payment initiation handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent user_id=a26936ee-debc-4fd7-bfaa-a93930d56b5d account_id=262b652d-bf2e-4aba-87b0-bb20af7206be amount=1000 currency=JPY correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <payment/initiation_handler.go:69> Server 🗄️ : ✅ [SUCCESS] Payment initiated successfully handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent payment_id=pi_3RmugiR7vH7wmQ1V2V9NbRRh correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <payment/persistence_handler.go:26> Server 🗄️ : received payment initiated event handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent event="{f43629f0-bfb7-455c-ae3c-8f71268992a7 e83cd823-e369-4467-a0be-6f336ba02041 pi_3RmugiR7vH7wmQ1V2V9NbRRh initiated a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c}"
10:41AM INFO <payment/persistence_handler.go:34> Server 🗄️ : updating transaction with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmugiR7vH7wmQ1V2V9NbRRh

2025/07/20 13:41:48 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:57
[0m[33m[0.736ms] [34;1m[rows:1][0m SELECT * FROM "transactions" WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL ORDER BY "transactions"."id" LIMIT 1
10:41AM WARN <payment/persistence_handler.go:58> Server 🗄️ : Duplicate PaymentIdPersistedEvent emission detected: transaction already has payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 existing_payment_id=pi_3RmugiR7vH7wmQ1V0E526UrY

2025/07/20 13:41:48 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:33
[0m[33m[0.927ms] [34;1m[rows:1][0m UPDATE "transactions" SET "payment_id"='pi_3RmugiR7vH7wmQ1V2V9NbRRh',"status"='pending',"updated_at"='2025-07-20 13:41:48.89' WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL
10:41AM INFO <payment/persistence_handler.go:70> Server 🗄️ : transaction updated with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmugiR7vH7wmQ1V2V9NbRRh
10:41AM INFO <payment/persistence_handler.go:26> Server 🗄️ : received payment initiated event handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent event="{f43629f0-bfb7-455c-ae3c-8f71268992a7 e83cd823-e369-4467-a0be-6f336ba02041 pi_3RmugiR7vH7wmQ1V2V9NbRRh initiated a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c}"
10:41AM INFO <payment/persistence_handler.go:34> Server 🗄️ : updating transaction with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmugiR7vH7wmQ1V2V9NbRRh

2025/07/20 13:41:48 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:57
[0m[33m[0.437ms] [34;1m[rows:1][0m SELECT * FROM "transactions" WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL ORDER BY "transactions"."id" LIMIT 1
10:41AM WARN <payment/persistence_handler.go:58> Server 🗄️ : Duplicate PaymentIdPersistedEvent emission detected: transaction already has payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 existing_payment_id=pi_3RmugiR7vH7wmQ1V2V9NbRRh

2025/07/20 13:41:48 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:33
[0m[33m[0.718ms] [34;1m[rows:1][0m UPDATE "transactions" SET "payment_id"='pi_3RmugiR7vH7wmQ1V2V9NbRRh',"status"='pending',"updated_at"='2025-07-20 13:41:48.893' WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL
10:41AM INFO <payment/persistence_handler.go:70> Server 🗄️ : transaction updated with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmugiR7vH7wmQ1V2V9NbRRh
10:41AM INFO <payment/initiation_handler.go:91> Server 🗄️ : 📤 [EMIT] PaymentInitiatedEvent published handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent event="{f43629f0-bfb7-455c-ae3c-8f71268992a7 e83cd823-e369-4467-a0be-6f336ba02041 pi_3RmugiR7vH7wmQ1V2V9NbRRh initiated a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c}" correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/conversion_done.go:19> Server 🗄️ : [DEPTH] Event received handler=DepositConversionDoneHandler event_type=DepositConversionDoneEvent type=DepositConversionDoneEvent depth=5 event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <deposit/conversion_done.go:20> Server 🗄️ : 🟢 [START] Received event handler=DepositConversionDoneHandler event_type=DepositConversionDoneEvent event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <deposit/conversion_done.go:29> Server 🗄️ : 🔄 [PROCESS] Mapping DepositConversionDoneEvent to DepositBusinessValidatedEvent handler=DepositConversionDoneHandler event_type=DepositConversionDoneEvent handler=DepositConversionDoneHandler event_type=DepositConversionDoneEvent correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c from_amount="1000 JPY" to_amount="1000 JPY" request_id=e83cd823-e369-4467-a0be-6f336ba02041
10:41AM INFO <deposit/conversion_done.go:36> Server 🗄️ : 📤 [EMIT] Emitting DepositBusinessValidatedEvent handler=DepositConversionDoneHandler event_type=DepositConversionDoneEvent event="{{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041} e83cd823-e369-4467-a0be-6f336ba02041}" correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <payment/initiation_handler.go:23> Server 🗄️ : 🟢 [START] Received validation event handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent event="{{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <payment/initiation_handler.go:44> Server 🗄️ : 🔄 [PROCESS] Processing deposit business validation for payment initiation handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent user_id=a26936ee-debc-4fd7-bfaa-a93930d56b5d account_id=262b652d-bf2e-4aba-87b0-bb20af7206be amount=1000 currency=JPY correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <payment/initiation_handler.go:69> Server 🗄️ : ✅ [SUCCESS] Payment initiated successfully handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent payment_id=pi_3RmugjR7vH7wmQ1V1U8v7gQ2 correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <payment/persistence_handler.go:26> Server 🗄️ : received payment initiated event handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent event="{3870992b-d989-4d55-804a-3177ddcf4930 e83cd823-e369-4467-a0be-6f336ba02041 pi_3RmugjR7vH7wmQ1V1U8v7gQ2 initiated a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c}"
10:41AM INFO <payment/persistence_handler.go:34> Server 🗄️ : updating transaction with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmugjR7vH7wmQ1V1U8v7gQ2

2025/07/20 13:41:49 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:57
[0m[33m[1.058ms] [34;1m[rows:1][0m SELECT * FROM "transactions" WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL ORDER BY "transactions"."id" LIMIT 1
10:41AM WARN <payment/persistence_handler.go:58> Server 🗄️ : Duplicate PaymentIdPersistedEvent emission detected: transaction already has payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 existing_payment_id=pi_3RmugiR7vH7wmQ1V2V9NbRRh

2025/07/20 13:41:49 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:33
[0m[33m[0.888ms] [34;1m[rows:1][0m UPDATE "transactions" SET "payment_id"='pi_3RmugjR7vH7wmQ1V1U8v7gQ2',"status"='pending',"updated_at"='2025-07-20 13:41:49.229' WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL
10:41AM INFO <payment/persistence_handler.go:70> Server 🗄️ : transaction updated with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmugjR7vH7wmQ1V1U8v7gQ2
10:41AM INFO <payment/persistence_handler.go:26> Server 🗄️ : received payment initiated event handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent event="{3870992b-d989-4d55-804a-3177ddcf4930 e83cd823-e369-4467-a0be-6f336ba02041 pi_3RmugjR7vH7wmQ1V1U8v7gQ2 initiated a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c}"
10:41AM INFO <payment/persistence_handler.go:34> Server 🗄️ : updating transaction with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmugjR7vH7wmQ1V1U8v7gQ2

2025/07/20 13:41:49 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:57
[0m[33m[0.518ms] [34;1m[rows:1][0m SELECT * FROM "transactions" WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL ORDER BY "transactions"."id" LIMIT 1
10:41AM WARN <payment/persistence_handler.go:58> Server 🗄️ : Duplicate PaymentIdPersistedEvent emission detected: transaction already has payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 existing_payment_id=pi_3RmugjR7vH7wmQ1V1U8v7gQ2

2025/07/20 13:41:49 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:33
[0m[33m[0.492ms] [34;1m[rows:1][0m UPDATE "transactions" SET "payment_id"='pi_3RmugjR7vH7wmQ1V1U8v7gQ2',"status"='pending',"updated_at"='2025-07-20 13:41:49.233' WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL
10:41AM INFO <payment/persistence_handler.go:70> Server 🗄️ : transaction updated with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmugjR7vH7wmQ1V1U8v7gQ2
10:41AM INFO <payment/initiation_handler.go:91> Server 🗄️ : 📤 [EMIT] PaymentInitiatedEvent published handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent event="{3870992b-d989-4d55-804a-3177ddcf4930 e83cd823-e369-4467-a0be-6f336ba02041 pi_3RmugjR7vH7wmQ1V1U8v7gQ2 initiated a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c}" correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/business_validation.go:18> Server 🗄️ : [DEPTH] Event received handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent type=DepositConversionDoneEvent depth=4 event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <deposit/business_validation.go:19> Server 🗄️ : 🟢 [START] Received event handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <deposit/business_validation.go:25> Server 🗄️ : [DEBUG] Incoming DepositConversionDoneEvent IDs handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent user_id=a26936ee-debc-4fd7-bfaa-a93930d56b5d account_id=262b652d-bf2e-4aba-87b0-bb20af7206be
10:41AM INFO <deposit/business_validation.go:36> Server 🗄️ : [CHECK] DepositConversionDoneEvent currencies at business validation handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c from_currency=JPY to_currency=JPY
10:41AM INFO <deposit/business_validation.go:39> Server 🗄️ : ✅ [SUCCESS] Business validation passed after conversion, emitting DepositBusinessValidatedEvent handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c user_id=a26936ee-debc-4fd7-bfaa-a93930d56b5d account_id=262b652d-bf2e-4aba-87b0-bb20af7206be amount=1000 currency=JPY correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/business_validation.go:51> Server 🗄️ : 📤 [EMIT] Emitting DepositBusinessValidatedEvent handler=DepositBusinessValidationHandler event_type=DepositConversionDoneEvent correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c event="{{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041} e83cd823-e369-4467-a0be-6f336ba02041}" correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <payment/initiation_handler.go:23> Server 🗄️ : 🟢 [START] Received validation event handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent event="{{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <payment/initiation_handler.go:44> Server 🗄️ : 🔄 [PROCESS] Processing deposit business validation for payment initiation handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent user_id=a26936ee-debc-4fd7-bfaa-a93930d56b5d account_id=262b652d-bf2e-4aba-87b0-bb20af7206be amount=1000 currency=JPY correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <payment/initiation_handler.go:69> Server 🗄️ : ✅ [SUCCESS] Payment initiated successfully handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent payment_id=pi_3RmugjR7vH7wmQ1V1Jh2tyn6 correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <payment/persistence_handler.go:26> Server 🗄️ : received payment initiated event handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent event="{aa5d7d0b-d0aa-4e6f-a8e4-43da4d719a5b e83cd823-e369-4467-a0be-6f336ba02041 pi_3RmugjR7vH7wmQ1V1Jh2tyn6 initiated a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c}"
10:41AM INFO <payment/persistence_handler.go:34> Server 🗄️ : updating transaction with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmugjR7vH7wmQ1V1Jh2tyn6

2025/07/20 13:41:49 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:57
[0m[33m[1.603ms] [34;1m[rows:1][0m SELECT * FROM "transactions" WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL ORDER BY "transactions"."id" LIMIT 1
10:41AM WARN <payment/persistence_handler.go:58> Server 🗄️ : Duplicate PaymentIdPersistedEvent emission detected: transaction already has payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 existing_payment_id=pi_3RmugjR7vH7wmQ1V1U8v7gQ2

2025/07/20 13:41:49 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:33
[0m[33m[1.131ms] [34;1m[rows:1][0m UPDATE "transactions" SET "payment_id"='pi_3RmugjR7vH7wmQ1V1Jh2tyn6',"status"='pending',"updated_at"='2025-07-20 13:41:49.579' WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL
10:41AM INFO <payment/persistence_handler.go:70> Server 🗄️ : transaction updated with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmugjR7vH7wmQ1V1Jh2tyn6
10:41AM INFO <payment/persistence_handler.go:26> Server 🗄️ : received payment initiated event handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent event="{aa5d7d0b-d0aa-4e6f-a8e4-43da4d719a5b e83cd823-e369-4467-a0be-6f336ba02041 pi_3RmugjR7vH7wmQ1V1Jh2tyn6 initiated a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c}"
10:41AM INFO <payment/persistence_handler.go:34> Server 🗄️ : updating transaction with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmugjR7vH7wmQ1V1Jh2tyn6

2025/07/20 13:41:49 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:57
[0m[33m[1.051ms] [34;1m[rows:1][0m SELECT * FROM "transactions" WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL ORDER BY "transactions"."id" LIMIT 1
10:41AM WARN <payment/persistence_handler.go:58> Server 🗄️ : Duplicate PaymentIdPersistedEvent emission detected: transaction already has payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 existing_payment_id=pi_3RmugjR7vH7wmQ1V1Jh2tyn6

2025/07/20 13:41:49 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:33
[0m[33m[0.521ms] [34;1m[rows:1][0m UPDATE "transactions" SET "payment_id"='pi_3RmugjR7vH7wmQ1V1Jh2tyn6',"status"='pending',"updated_at"='2025-07-20 13:41:49.584' WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL
10:41AM INFO <payment/persistence_handler.go:70> Server 🗄️ : transaction updated with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmugjR7vH7wmQ1V1Jh2tyn6
10:41AM INFO <payment/initiation_handler.go:91> Server 🗄️ : 📤 [EMIT] PaymentInitiatedEvent published handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent event="{aa5d7d0b-d0aa-4e6f-a8e4-43da4d719a5b e83cd823-e369-4467-a0be-6f336ba02041 pi_3RmugjR7vH7wmQ1V1Jh2tyn6 initiated a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c}" correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <deposit/conversion_done.go:19> Server 🗄️ : [DEPTH] Event received handler=DepositConversionDoneHandler event_type=DepositConversionDoneEvent type=DepositConversionDoneEvent depth=4 event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <deposit/conversion_done.go:20> Server 🗄️ : 🟢 [START] Received event handler=DepositConversionDoneHandler event_type=DepositConversionDoneEvent event="{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <deposit/conversion_done.go:29> Server 🗄️ : 🔄 [PROCESS] Mapping DepositConversionDoneEvent to DepositBusinessValidatedEvent handler=DepositConversionDoneHandler event_type=DepositConversionDoneEvent handler=DepositConversionDoneHandler event_type=DepositConversionDoneEvent correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c from_amount="1000 JPY" to_amount="1000 JPY" request_id=e83cd823-e369-4467-a0be-6f336ba02041
10:41AM INFO <deposit/conversion_done.go:36> Server 🗄️ : 📤 [EMIT] Emitting DepositBusinessValidatedEvent handler=DepositConversionDoneHandler event_type=DepositConversionDoneEvent event="{{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041} e83cd823-e369-4467-a0be-6f336ba02041}" correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <payment/initiation_handler.go:23> Server 🗄️ : 🟢 [START] Received validation event handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent event="{{{{{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} 9df3ba26-6cad-4a2e-ab11-75bbf2c566e7 1000 JPY deposit 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084} <nil>} {{deposit a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c} ce91b73d-eede-4fef-9df5-483c4619ac41 1000 JPY 1000 JPY e83cd823-e369-4467-a0be-6f336ba02041 e83cd823-e369-4467-a0be-6f336ba02041 2025-07-20 13:41:45.340915 +0300 EEST m=+5.010891084 1 JPY 1000} e83cd823-e369-4467-a0be-6f336ba02041} e83cd823-e369-4467-a0be-6f336ba02041}"
10:41AM INFO <payment/initiation_handler.go:44> Server 🗄️ : 🔄 [PROCESS] Processing deposit business validation for payment initiation handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent user_id=a26936ee-debc-4fd7-bfaa-a93930d56b5d account_id=262b652d-bf2e-4aba-87b0-bb20af7206be amount=1000 currency=JPY correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <payment/initiation_handler.go:69> Server 🗄️ : ✅ [SUCCESS] Payment initiated successfully handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent payment_id=pi_3RmugjR7vH7wmQ1V2I9wAZ6L correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
10:41AM INFO <payment/persistence_handler.go:26> Server 🗄️ : received payment initiated event handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent event="{0e73a98b-a52b-4c1b-947b-d04329304a49 e83cd823-e369-4467-a0be-6f336ba02041 pi_3RmugjR7vH7wmQ1V2I9wAZ6L initiated a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c}"
10:41AM INFO <payment/persistence_handler.go:34> Server 🗄️ : updating transaction with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmugjR7vH7wmQ1V2I9wAZ6L

2025/07/20 13:41:49 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:57
[0m[33m[1.580ms] [34;1m[rows:1][0m SELECT * FROM "transactions" WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL ORDER BY "transactions"."id" LIMIT 1
10:41AM WARN <payment/persistence_handler.go:58> Server 🗄️ : Duplicate PaymentIdPersistedEvent emission detected: transaction already has payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 existing_payment_id=pi_3RmugjR7vH7wmQ1V1Jh2tyn6

2025/07/20 13:41:49 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:33
[0m[33m[0.982ms] [34;1m[rows:1][0m UPDATE "transactions" SET "payment_id"='pi_3RmugjR7vH7wmQ1V2I9wAZ6L',"status"='pending',"updated_at"='2025-07-20 13:41:49.927' WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL
10:41AM INFO <payment/persistence_handler.go:70> Server 🗄️ : transaction updated with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmugjR7vH7wmQ1V2I9wAZ6L
10:41AM INFO <payment/persistence_handler.go:26> Server 🗄️ : received payment initiated event handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent event="{0e73a98b-a52b-4c1b-947b-d04329304a49 e83cd823-e369-4467-a0be-6f336ba02041 pi_3RmugjR7vH7wmQ1V2I9wAZ6L initiated a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c}"
10:41AM INFO <payment/persistence_handler.go:34> Server 🗄️ : updating transaction with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmugjR7vH7wmQ1V2I9wAZ6L

2025/07/20 13:41:49 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:57
[0m[33m[0.824ms] [34;1m[rows:1][0m SELECT * FROM "transactions" WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL ORDER BY "transactions"."id" LIMIT 1
10:41AM WARN <payment/persistence_handler.go:58> Server 🗄️ : Duplicate PaymentIdPersistedEvent emission detected: transaction already has payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 existing_payment_id=pi_3RmugjR7vH7wmQ1V2I9wAZ6L

2025/07/20 13:41:49 [32m/Users/amir/projects/fintech/infra/repository/transaction/repository.go:33
[0m[33m[0.774ms] [34;1m[rows:1][0m UPDATE "transactions" SET "payment_id"='pi_3RmugjR7vH7wmQ1V2I9wAZ6L',"status"='pending',"updated_at"='2025-07-20 13:41:49.932' WHERE id = 'e83cd823-e369-4467-a0be-6f336ba02041' AND "transactions"."deleted_at" IS NULL
10:41AM INFO <payment/persistence_handler.go:70> Server 🗄️ : transaction updated with payment ID handler=PaymentPersistenceHandler event_type=PaymentInitiatedEvent transaction_id=e83cd823-e369-4467-a0be-6f336ba02041 payment_id=pi_3RmugjR7vH7wmQ1V2I9wAZ6L
10:41AM INFO <payment/initiation_handler.go:91> Server 🗄️ : 📤 [EMIT] PaymentInitiatedEvent published handler=PaymentInitiationHandler event_type=DepositBusinessValidatedEvent event="{0e73a98b-a52b-4c1b-947b-d04329304a49 e83cd823-e369-4467-a0be-6f336ba02041 pi_3RmugjR7vH7wmQ1V2I9wAZ6L initiated a26936ee-debc-4fd7-bfaa-a93930d56b5d 262b652d-bf2e-4aba-87b0-bb20af7206be 34b0ce52-5c4f-4d3d-973c-92fc38ec850c}" correlation_id=34b0ce52-5c4f-4d3d-973c-92fc38ec850c
